<div class="col-md-8">
  <%= form_for document do |f| %>
    <% if document.errors.any? %>
      <div class="errors error-list">
        <h2>Please fix the following errors found in the form</h2>
        <ul class="errors">
          <% document.errors.each do |field, errors| %>
            <% if errors %>
              <li><%= field.to_s.humanize %> <%= [*errors].join(' and ')  %></li>
            <% end %>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%= f.text_field :title %>
    <%= f.text_area :summary, class: 'short-textarea' %>
    <%= f.text_area :body %>

    <div class="preview_button"></div>
    <div class="preview_container" style="display: none;"></div>

    <%= render partial: "#{f.object.document_type}_form_extra_fields", locals: { f: f } %>

    <div class="actions">
      <button name="save" class="btn btn-success">Save as draft</button>
    </div>
  <% end %>
</div>

<div class="col-md-4">
  <%= render partial: 'shared/govspeak-help' %>

  <h2>Attachments</h2>

  <% if document.persisted? %>
    <%= link_to "Add attachment", new_specialist_document_attachment_path(document) %>
  <% else %>
    <p>To add an attachment, please save the draft first.</p>
  <% end %>

  <ul class="attachments">
    <% document.attachments.each do |attachment| %>
      <li class="attachment">
        <span class="title"><%= attachment.title %></span>
        <span class="snippet"><%= attachment.snippet %></span>
        <%= link_to "edit", edit_specialist_document_attachment_path(document, attachment) %>
      </li>
    <% end %>
  </ul>
</div>

<%= content_for :document_ready do %>
  window.SpecialistDocument.addPreviewFeature({
    'url'             : '<%= preview_path_for_specialist_document(document) %>',
    'insert_into'     : '.preview_container',
    'insert_button'   : '.preview_button',
    'render_to'       : '.preview .govspeak',
    'data_target'     : function() {
                          return {
                            'specialist_document' : {
                              'body' : $('#specialist_document_body').val()
                            }
                          };
                        }
  });
<% end -%>
