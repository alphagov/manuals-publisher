#!/usr/bin/env ruby

require File.expand_path("../../config/environment", __FILE__)
require "logger"

logger = Logger.new(STDOUT)
logger.formatter = Logger::Formatter.new

manual_publication_log_filter = ManualPublicationLogFilter.new

manual_records = ManualRecord.all
count = manual_record.count

logger.info "Deleting publication logs and rebuilding for major updates only for #{count} manuals"

manual_records.each.with_index(1) do |manual, i|
  logger.info("[% 3d/% 3d] id=%s slug=%s" % [i, count, manual.id, manual.slug])
  manual_publication_log_filter.delete_logs_and_rebuild_for_major_updates_only!(manual.slug)
end

logger.info "Rebuilding of publication logs complete."
